# ==========================
# Stockelper LLM (.env 템플릿)
# ==========================
#
# 사용 방법:
# - 이 파일을 `.env`로 복사한 뒤 값을 채우세요. (`.env`는 커밋 금지)
# - Docker compose 사용 시 compose의 env_file(.env)로 로드됩니다.
#
# 네트워크 주의:
# - LLM 서버가 실제로 접근 가능한 주소로
#   `STOCKELPER_BACKTESTING_URL`, `STOCKELPER_PORTFOLIO_URL`을 설정해야 합니다.
# - (기억) 추후 운영 환경에서 LLM 서버는 `http://54.180.25.182:21009`로 빌드/배포될 예정입니다.
#   이때 10.x 사설 IP는 그대로는 접근이 불가할 수 있으니(VPC/VPN/터널/LB 등) 네트워크 경로를 확보하세요.
#

############################
# Server (LLM)
############################
HOST=0.0.0.0
PORT=21009
DEBUG=false

############################
# Service / timeouts
############################
# 서비스 모드: chat (권장)
STOCKELPER_SERVICE=chat
# 기본 HTTP 타임아웃(초) - portfolio/backtesting 요청에 fallback으로 사용
REQUESTS_TIMEOUT=300
# 에러 상세(traceback) SSE로 노출 (운영에서는 false 권장)
DEBUG_ERRORS=false

############################
# External service URLs (LLM -> Portfolio/Backtesting)
############################
# Backtesting (필수)
# - Docker 네트워크(권장): http://backtesting-server:21007
# - 현재 사내/온프렘 예시: http://10.0.10.230:21007
# - 클라우드 예시: http://<backtesting-public-or-vpc-ip>:21007
STOCKELPER_BACKTESTING_URL=http://backtesting-server:21007

# Portfolio (선택)
# - Docker 네트워크(권장): http://portfolio-server:21008
# - 현재 사내/온프렘 예시: http://10.0.10.230:21008
# - 클라우드 예시: http://<portfolio-public-or-vpc-ip>:21008
STOCKELPER_PORTFOLIO_URL=http://portfolio-server:21008

# 포트폴리오 추천은 수 분 이상 걸릴 수 있어 타임아웃을 넉넉히 두는 것을 권장합니다.
PORTFOLIO_REQUESTS_TIMEOUT=600

############################
# AI / LLM
############################
OPENAI_API_KEY=
# (선택) WebSearch(OpenRouter/Perplexity) 등을 쓸 경우
OPENROUTER_API_KEY=
# (선택) 전체 모델을 통일하려면 지정
STOCKELPER_LLM_MODEL=
# (선택) 구버전 호환: STOCKELPER_LLM_MODEL 미설정 시 fallback
STOCKELPER_MODEL=
# (선택) 백테스트 요청 파라미터 생성 모델
STOCKELPER_BACKTESTING_REQUEST_MODEL=
# (선택) 포트폴리오 추천 요청 파라미터 생성 모델
STOCKELPER_PORTFOLIO_REQUEST_MODEL=

############################
# External APIs (optional per tool)
############################
OPEN_DART_API_KEY=
YOUTUBE_API_KEY=

############################
# Databases (required for full 기능)
############################
# stockelper_web DB (사용자/백테스트 결과/해석 저장)
# - Docker compose 예) postgresql://postgres:postgres@db:5432/stockelper_web
# - 로컬 예)         postgresql://postgres:postgres@localhost:5432/stockelper_web
# - 운영/클라우드 예) postgresql://postgres:postgres@54.180.25.182:5432/stockelper_web
DATABASE_URL=postgresql://postgres:postgres@db:5432/stockelper_web

# (선택) SQLAlchemy async URL - 미지정 시 DATABASE_URL을 asyncpg로 자동 변환
ASYNC_DATABASE_URL=

# (선택) backtesting 해석 저장 시, 명시적으로 stockelper_web만 가리키고 싶으면 사용
STOCKELPER_WEB_DATABASE_URL=

# (선택) LangGraph 체크포인터 DB
# - 미지정 시 DATABASE_URL(=stockelper_web)을 사용합니다.
CHECKPOINT_DATABASE_URI=

# (레거시/확장) KSIC(산업분류) DB
DATABASE_URL_KSIC=
ASYNC_DATABASE_URL_KSIC=

# stockelper_web 스키마/테이블
STOCKELPER_WEB_SCHEMA=public
STOCKELPER_BACKTESTING_TABLE=backtesting

############################
# Backtesting request planner (LLM preflight/guardrails)
############################
# 사용자가 기간을 말하지 않으면 최근 N년으로 기본 설정
STOCKELPER_BACKTEST_DEFAULT_YEARS=3
# 과도한 DB/연산을 막기 위해 최대 기간(년)을 제한(초과 시 자동 축소)
STOCKELPER_BACKTEST_MAX_YEARS=5
# 대상 종목 최대 개수 제한(과도한 요청 방지)
STOCKELPER_BACKTEST_MAX_TARGET_SYMBOLS=50
# (주의) 전체 유니버스 백테스트 허용 여부
STOCKELPER_BACKTEST_ALLOW_FULL_UNIVERSE=false

############################
# Backtest interpretation (LLM post-processing)
############################
# (선택) 해석 전용 모델을 별도로 쓰고 싶으면 지정
STOCKELPER_BACKTESTING_ANALYSIS_MODEL=
BACKTEST_ANALYSIS_HTTP_TIMEOUT=60

############################
# KIS (Korea Investment & Securities)
############################
# 사용자별 kis_app_key/kis_app_secret/account_no/kis_access_token 은
# stockelper_web.users 테이블에서 user_id로 조회/갱신합니다.
KIS_BASE_URL=https://openapivts.koreainvestment.com:29443
KIS_TR_ID_BALANCE=VTTC8434R
KIS_TR_ID_ORDER_BUY=VTTC0802U
KIS_TR_ID_ORDER_SELL=VTTC0011U
KIS_TR_ID_PRICE=FHKST01010100

# (선택) 종목명→종목코드 매핑은 KIS 종목마스터(mst.zip)에서 로드합니다.
# - 미지정 시: kospi/kosdaq/konex mst.zip 기본 URL 사용
# - 여러 URL은 콤마(,)로 구분
KIS_STOCK_MASTER_URLS=
KIS_STOCK_MASTER_TIMEOUT=30
STOCK_LISTING_USER_AGENT=Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0 Safari/537.36

# (선택) DB(users) 대신 env로 KIS 자격증명 fallback (테스트용)
KIS_APP_KEY=
KIS_APP_SECRET=
KIS_ACCOUNT_NO=
KIS_ACCESS_TOKEN=

############################
# Neo4j (optional)
############################
NEO4J_URI=
NEO4J_USER=
NEO4J_PASSWORD=

############################
# Redis (legacy/optional)
############################
REDIS_HOST=
REDIS_PORT=
REDIS_AUTH=

############################
# MongoDB (optional)
############################
MONGO_URI=

############################
# Langfuse (legacy/optional)
############################
LANGFUSE_ENABLED=false
LANGFUSE_PUBLIC_KEY=
LANGFUSE_SECRET_KEY=
LANGFUSE_HOST=

############################
# Local integration test helpers (optional)
############################
# scripts/healthcheck_integrations.py에서 사용하는 user_id
STOCKELPER_TEST_USER_ID=2
